% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/09_chunked_api.R
\name{upload_with_provider}
\alias{upload_with_provider}
\title{Upload with custom chunk provider (Layer 2: Functional API)}
\usage{
upload_with_provider(
  config,
  filename,
  total_size,
  file_hash,
  chunk_provider,
  chunk_size_mb = 10,
  content_type = "application/octet-stream",
  metadata = NULL,
  on_progress = NULL,
  show_progress = TRUE,
  max_retries = 3
)
}
\arguments{
\item{config}{API configuration created by create_api_config}

\item{filename}{Name for the uploaded file}

\item{total_size}{Total size of the file in bytes}

\item{file_hash}{SHA-256 hash of the complete file}

\item{chunk_provider}{Function that returns chunks: function(chunk_num, chunk_size) -> raw or NULL}

\item{chunk_size_mb}{Size of each chunk in megabytes (default: 10)}

\item{content_type}{MIME type (default: "application/octet-stream")}

\item{metadata}{Optional metadata dictionary}

\item{on_progress}{Optional callback function(chunk_num, total_chunks, percent)}

\item{show_progress}{Show progress bar (default: TRUE)}

\item{max_retries}{Maximum retries per chunk (default: 3)}
}
\value{
TRUE if upload successful
}
\description{
Upload with custom chunk provider (Layer 2: Functional API)
}
\details{
This is a Layer 2 (functional) API that manages the session lifecycle automatically.
You provide a chunk_provider function that knows how to extract each chunk.
The system handles session management, retry logic, progress reporting, and cleanup.

The chunk_provider function receives (chunk_num, chunk_size) and should return:
\itemize{
\item A raw vector with the chunk data, or
\item NULL when there are no more chunks
}
}
\examples{
\dontrun{
# Example: Upload from a serialized object in memory
obj <- list(data = 1:1000000)
serialized <- serialize(obj, NULL)
file_hash <- hash_content(serialized)

# Chunk provider that extracts from serialized bytes
provider <- function(chunk_num, chunk_size) {
  start <- chunk_num * chunk_size + 1
  end <- min(start + chunk_size - 1, length(serialized))
  if (start > length(serialized)) return(NULL)
  serialized[start:end]
}

upload_with_provider(config, "data.rds", length(serialized), 
                     file_hash, provider)
}
}
